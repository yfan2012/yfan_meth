library(tidyverse)
library(cowplot)

datadir='/mithril/Data/Nanopore/projects/methbin/rerio/'
dbxdir='~/Dropbox/yfan/methylation/methbin/rerio/'

##Just doing modA comparison
samps=c('neb17', 'neb19')
motifs=c('GANTC', 'GATC')

plot_modprobs <- function(samp) {
    cols=c('readid', 'readpos', 'refpos', 'base', 'chr', 'pA', 'pAmod', 'pC', 'pCmod')
    sampmodinfo=tibble(
        readid=as.character(),
        readpos=as.numeric(),
        refpos=as.numeric(),
        base=as.character(),
        chr=as.character(),
        pA=as.numeric(),
        pAmod=as.numeric(),
        pC=as.numeric(),
        pCmod=as.numeric(),
        samp=as.character(),
        motif=as.character()
    )
    
    for (motif in motifs) {
        modfile=paste0(datadir, samp, '/assess/', samp, '.', motif, '.csv')
        modinfo=read_csv(modfile, col_names=cols) %>%
            mutate(motif=motif) %>%
            mutate(samp=samp)
        sampmodinfo=rbind(sampmodinfo, modinfo)
    }
    
    ##basic density of pA 
    plot=ggplot(sampmodinfo, aes(x=pA, colour=motif, fill=motif, alpha=.3)) +
        geom_density() +
        ggtitle(samp) +
        xlab('Prob Meth') +
        theme_bw()
    return(plot)
}

neb17=plot_modprobs('neb17')
aligned=align_plots(neb17, plots[2], align='v')
outfile=paste0(dbxdir, 'rerio_Amod.pdf')
pdf(outfile, h=11, w=6)
ggdraw(aligned[[1]])
dev.off()



